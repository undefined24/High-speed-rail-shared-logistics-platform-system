<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.undefined24.ssm.dao.AdminMapper">

<select id="adminLogin" resultType="administrator" parameterType="administrator">
select * from administrator where adminname=#{adminname} and adminpwd=#{adminpwd}
</select>

<update id="adminChangePwd" parameterType="administrator" >
update administrator set adminpwd=#{adminpwd} where adminID = #{adminID}
</update>

<insert id="addWorker" parameterType="worker" useGeneratedKeys="true">
insert into worker(workername,workerposition,workersex,workersalary,workercheckcard) values(#{workername},#{workerposition},#{workersex},#{workersalary},#{workercheckcard})
</insert>

<select id="checkWorker" resultType="worker" parameterType="worker">
select * from worker where workername=#{workername}
</select>

<select id="showWorker" resultType="worker">
select * from worker order by workerID
</select>

<select id="showEidtWorker" parameterType="int" resultType="worker">
select * from worker where workerID=#{workerID}
</select>

<update id="editWorker" parameterType="worker">
update worker
<set>
<if test="workername!=null">workername=#{workername},</if>
<if test="workerposition!=null">workerposition=#{workerposition},</if>
<if test="workersex!=null">workersex=#{workersex},</if>
<if test="workersalary!=null">workersalary=#{workersalary},</if>
<if test="workercheckcard!=null">workercheckcard=#{workercheckcard}</if>
</set>
where workerID = #{workerID}
</update>

<delete id="deleteWorker" parameterType="worker">
delete from worker where workerID = #{workerID}
</delete>

<select id="searchWorker" resultType="worker" parameterType="string">
select * from worker where workerID in
    (select workerID from worker where workerID REGEXP #{search})
    union
select * from worker where workername REGEXP #{search}
</select>

<select id="showUser" resultType="user">
select * from user_info order by userID
</select>

<select id="showEditUser" resultType="user" parameterType="int">
select * from user_info where userID=#{userID}
</select>

<select id="searchUser" resultType="user" parameterType="string">
select * from user_info where userID in
    (select userID from user_info where userID REGEXP #{search})
    union
select * from user_info where nickname REGEXP #{search}
</select>

<delete id="deleteUser" parameterType="user">
delete from user_info where userID = #{userID}
</delete>

<select id="checkUser" resultType="user" parameterType="user">
select * from user_info where nickname=#{nickname}
</select>

<update id="editUser" parameterType="user">
update user_info
<set>
<if test="nickname!=null">nickname=#{nickname},</if>
<if test="usersex!=null">usersex=#{usersex},</if>
<if test="userphone!=null">userphone=#{userphone},</if>
<if test="usernumber!=null">usernumber=#{usernumber},</if>
<if test="useraddress!=null">useraddress=#{useraddress}</if>
</set>
where userID = #{userID}
</update>

<select id="selectBill" resultType="bill" parameterType="int">
select * from bill where trackingID=#{trackingID}
</select>

<select id="goodsManage" resultMap="goodsResult">
select * from goods_info
</select>
<resultMap type="goods" id="goodsResult">
<id property="trackingID" column="trackingID"/>
<result property="weight" column="weight"/>
<result property="type" column="type"/>
<result property="name" column="name"/>
<association property="bill" column="trackingID" select="selectBill" javaType="bill"></association>
</resultMap>

<select id="searchGoods" resultMap="goodsResult" parameterType="string">
select * from goods_info where trackingID in
    (select trackingID from goods_info where trackingID REGEXP #{search})
    union
select * from goods_info where name REGEXP #{search}
</select>
</mapper>